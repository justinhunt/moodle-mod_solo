{"version":3,"file":"grammarsuggestions.min.js","sources":["../src/grammarsuggestions.js"],"sourcesContent":["define(['jquery', 'core/log','mod_solo/definitions','core/str','core/ajax','core/notification','mod_solo/correctionsmarkup'],\n    function ($, log, def, str, Ajax, notification,correctionsmarkup) {\n    \"use strict\"; // jshint ;_;\n    /*\n    This file does small report\n     */\n\n    log.debug('Grammar suggestions: initialising');\n\n    return {\n        //controls\n        controls: {},\n        ready: false,\n        activityid: 0,\n        checking: '... checking ...',\n        nosuggestions: 'No suggestions',\n\n        //init the module\n        init: function(activityid){\n            this.activityid=activityid;\n            this.ready=false;\n            this.init_strings();\n            this.register_controls();\n            this.register_events();\n        },\n\n        init_strings: function(){\n          var that =this;\n          str.get_string('checking','mod_solo').done(function(s){that.checking=s;});\n          str.get_string('nosuggestions','mod_solo').done(function(s){that.nosuggestions=s;});\n        },\n\n        //load all the controls so we do not have to do it later\n        register_controls: function(){\n            this.controls.grammarsuggestionscont = $('#' + def.grammarsuggestionscont);\n            this.controls.checkgrammarbutton = $('.' + def.checkgrammarbutton);\n            this.controls.selftranscript = $(\"textarea[name='selftranscript']\");\n        },\n\n        //attach the various event handlers we need\n        register_events: function() {\n            var that = this;\n            that.controls.checkgrammarbutton.click(function(e){\n                e.preventDefault();\n                //quit if its empty\n                var text = that.controls.selftranscript.val();\n                if(!text || text==='' || text.trim()===''){\n                    return;\n                }\n                that.controls.grammarsuggestionscont.show();\n                that.check_grammar(that);\n            });\n        },//end of register events\n\n        check_grammar: function (that) {\n\n            //do the check\n            var text = that.controls.selftranscript.val();\n            //but quit if its empty\n            if(!text || text==='' || text.trim()===''){\n                return;\n            }\n            that.controls.grammarsuggestionscont.text(that.checking);\n            Ajax.call([{\n                methodname: 'mod_solo_check_grammar',\n                args: {\n                    activityid: that.activityid,\n                    text: text\n\n                },\n                done: function (ajaxresult) {\n                    try {\n                        log.debug(ajaxresult);\n                        var payloadobject = JSON.parse(ajaxresult);\n                        if (payloadobject) {\n                            if(payloadobject.grammarerrors.length<3){\n                                //hacky but fast way to flag no errors\n                                that.controls.grammarsuggestionscont.text(that.nosuggestions);\n                                log.debug('grammar errors too short for errors');\n                            }else{\n                                that.controls.grammarsuggestionscont.html(payloadobject.suggestions);\n                                var opts = [];\n                                opts['sessionerrors'] = payloadobject.grammarerrors;\n                                opts['sessionmatches'] = payloadobject.grammarmatches;\n                                opts['insertioncount'] = payloadobject.insertioncount;\n                                log.debug('marking up corrections');\n                                correctionsmarkup.init(opts);\n                                //hacky way to hide empty original fields\n                                $('.mod_solo_corrections_cont .mod_solo_grading_original_preword').hide();\n                                $('.mod_solo_corrections_cont .mod_solo_grading_original_postword').hide();\n                            }\n\n                        }else{\n                            //something went wrong, user does not really need to know details\n                            that.controls.grammarsuggestionscont.text(that.nosuggestions);\n                            log.debug('result not fetched');\n                        }\n                    } catch(e){\n                        //something went wrong, user does not really need to know details\n                        that.controls.grammarsuggestionscont.text(that.nosuggestions);\n                        log.debug('something went wrong, result was not JSON');\n                    }\n\n\n                },\n                fail: notification.exception\n            }]);\n        },\n\n    };//end of return value\n});"],"names":["define","$","log","def","str","Ajax","notification","correctionsmarkup","debug","controls","ready","activityid","checking","nosuggestions","init","init_strings","register_controls","register_events","that","this","get_string","done","s","grammarsuggestionscont","checkgrammarbutton","selftranscript","click","e","preventDefault","text","val","trim","show","check_grammar","call","methodname","args","ajaxresult","payloadobject","JSON","parse","grammarerrors","length","html","suggestions","opts","grammarmatches","insertioncount","hide","fail","exception"],"mappings":"AAAAA,qCAAO,CAAC,SAAU,WAAW,uBAAuB,WAAW,YAAY,oBAAoB,+BAC3F,SAAUC,EAAGC,IAAKC,IAAKC,IAAKC,KAAMC,aAAaC,0BAM/CL,IAAIM,MAAM,qCAEH,CAEHC,SAAU,GACVC,OAAO,EACPC,WAAY,EACZC,SAAU,mBACVC,cAAe,iBAGfC,KAAM,SAASH,iBACNA,WAAWA,gBACXD,OAAM,OACNK,oBACAC,yBACAC,mBAGTF,aAAc,eACRG,KAAMC,KACVf,IAAIgB,WAAW,WAAW,YAAYC,MAAK,SAASC,GAAGJ,KAAKN,SAASU,KACrElB,IAAIgB,WAAW,gBAAgB,YAAYC,MAAK,SAASC,GAAGJ,KAAKL,cAAcS,MAIjFN,kBAAmB,gBACVP,SAASc,uBAAyBtB,EAAE,IAAME,IAAIoB,6BAC9Cd,SAASe,mBAAqBvB,EAAE,IAAME,IAAIqB,yBAC1Cf,SAASgB,eAAiBxB,EAAE,oCAIrCgB,gBAAiB,eACTC,KAAOC,KACXD,KAAKT,SAASe,mBAAmBE,OAAM,SAASC,GAC5CA,EAAEC,qBAEEC,KAAOX,KAAKT,SAASgB,eAAeK,MACpCD,MAAe,KAAPA,MAA2B,KAAdA,KAAKE,SAG9Bb,KAAKT,SAASc,uBAAuBS,OACrCd,KAAKe,cAAcf,WAI3Be,cAAe,SAAUf,UAGjBW,KAAOX,KAAKT,SAASgB,eAAeK,MAEpCD,MAAe,KAAPA,MAA2B,KAAdA,KAAKE,SAG9Bb,KAAKT,SAASc,uBAAuBM,KAAKX,KAAKN,UAC/CP,KAAK6B,KAAK,CAAC,CACPC,WAAY,yBACZC,KAAM,CACFzB,WAAYO,KAAKP,WACjBkB,KAAMA,MAGVR,KAAM,SAAUgB,gBAERnC,IAAIM,MAAM6B,gBACNC,cAAgBC,KAAKC,MAAMH,eAC3BC,iBACGA,cAAcG,cAAcC,OAAO,EAElCxB,KAAKT,SAASc,uBAAuBM,KAAKX,KAAKL,eAC/CX,IAAIM,MAAM,2CACT,CACDU,KAAKT,SAASc,uBAAuBoB,KAAKL,cAAcM,iBACpDC,KAAO,GACXA,KAAI,cAAoBP,cAAcG,cACtCI,KAAI,eAAqBP,cAAcQ,eACvCD,KAAI,eAAqBP,cAAcS,eACvC7C,IAAIM,MAAM,0BACVD,kBAAkBO,KAAK+B,MAEvB5C,EAAE,iEAAiE+C,OACnE/C,EAAE,kEAAkE+C,YAKxE9B,KAAKT,SAASc,uBAAuBM,KAAKX,KAAKL,eAC/CX,IAAIM,MAAM,sBAEhB,MAAMmB,GAEJT,KAAKT,SAASc,uBAAuBM,KAAKX,KAAKL,eAC/CX,IAAIM,MAAM,+CAKlByC,KAAM3C,aAAa4C"}