define(["jquery","core/log","mod_solo/definitions","core/str","core/ajax","core/notification","mod_solo/correctionsmarkup"],(function($,log,def,str,Ajax,notification,correctionsmarkup){return log.debug("Grammar suggestions: initialising"),{controls:{},ready:!1,activityid:0,checking:"... checking ...",nosuggestions:"No suggestions",init:function(activityid){this.activityid=activityid,this.ready=!1,this.init_strings(),this.register_controls(),this.register_events()},init_strings:function(){var that=this;str.get_string("checking","mod_solo").done((function(s){that.checking=s})),str.get_string("nosuggestions","mod_solo").done((function(s){that.nosuggestions=s}))},register_controls:function(){this.controls.grammarsuggestionscont=$("#"+def.grammarsuggestionscont),this.controls.checkgrammarbutton=$("."+def.checkgrammarbutton),this.controls.selftranscript=$("textarea[name='selftranscript']")},register_events:function(){var that=this;that.controls.checkgrammarbutton.click((function(e){e.preventDefault();var text=that.controls.selftranscript.val();text&&""!==text&&""!==text.trim()&&(that.controls.grammarsuggestionscont.show(),that.check_grammar(that))}))},check_grammar:function(that){var text=that.controls.selftranscript.val();text&&""!==text&&""!==text.trim()&&(that.controls.grammarsuggestionscont.text(that.checking),Ajax.call([{methodname:"mod_solo_check_grammar",args:{activityid:that.activityid,text:text},done:function(ajaxresult){try{log.debug(ajaxresult);var payloadobject=JSON.parse(ajaxresult);if(payloadobject)if(payloadobject.grammarerrors.length<3)that.controls.grammarsuggestionscont.text(that.nosuggestions),log.debug("grammar errors too short for errors");else{that.controls.grammarsuggestionscont.html(payloadobject.suggestions);var opts=[];opts.sessionerrors=payloadobject.grammarerrors,opts.sessionmatches=payloadobject.grammarmatches,opts.insertioncount=payloadobject.insertioncount,log.debug("marking up corrections"),correctionsmarkup.init(opts),$(".mod_solo_corrections_cont .mod_solo_grading_original_preword").hide(),$(".mod_solo_corrections_cont .mod_solo_grading_original_postword").hide()}else that.controls.grammarsuggestionscont.text(that.nosuggestions),log.debug("result not fetched")}catch(e){that.controls.grammarsuggestionscont.text(that.nosuggestions),log.debug("something went wrong, result was not JSON")}},fail:notification.exception}]))}}}));

//# sourceMappingURL=grammarsuggestions.min.js.map