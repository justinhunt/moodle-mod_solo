{"version":3,"file":"aigradepreview.min.js","sources":["../src/aigradepreview.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/ //\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport {get_strings} from 'core/str';\nimport Ajax from 'core/ajax';\nimport Log from 'core/log';\nimport Notify from 'core/notification';\nimport Templates from 'core/templates';\n\n/**\n * Question AI Text Edit Form Helper\n *\n * @module     mod_solo/aigradepreview\n * @copyright  2024 Justin Hunt <justin@poodll.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nvar Selectors = {\n    fields: {\n        sampleanswer: '#', //text input\n        sampleanswereval: '#', //div to push results to\n        feedbackscheme: '#', //text input\n        markscheme: '#', //text input\n        maxmarks: '#', //text input\n    },\n};\n\n/**\n * Initialise the format chooser.\n */\nexport const init = (props) => {\n\n    //get feedback button\n    var previewbtn = document.querySelector(props.previewbtnid);\n\n    //set up selectors\n    Selectors.fields.sampleanswer = props.sampleanswerid;\n    Selectors.fields.sampleanswereval = props.sampleanswerevalid;\n    Selectors.fields.feedbackscheme = props.feedbackschemeid;\n    Selectors.fields.markscheme = props.markschemeid;\n   // Selectors.fields.maxmarks = props.maxmarksid;\n    Selectors.fields.region = props.regionid;\n    Selectors.fields.targetlanguage = props.targetlanguageid;\n    Selectors.fields.feedbacklanguage = props.feedbacklanguageid;\n\n\n    // Set up strings\n    var strings={};\n    get_strings([\n        { \"key\": \"prompttester\", \"component\": 'mod_solo'},\n        { \"key\": \"sampleanswerempty\", \"component\": 'mod_solo'},\n\n    ]).done(function (s) {\n        var i = 0;\n        strings.prompttester = s[i++];\n        strings.sampleanswerempty = s[i++];\n    });\n    Log.debug(\"addinge event listener to preview button\");\n\n    previewbtn.addEventListener('click', e => {\n\n        const form = e.target.closest('form');\n        const questiontext = form.querySelector(Selectors.fields.questiontext);\n        const sampleanswer = form.querySelector(Selectors.fields.sampleanswer);\n        const sampleanswereval = form.querySelector(Selectors.fields.sampleanswereval);\n        const feedbackscheme = form.querySelector(Selectors.fields.feedbackscheme);\n        const markscheme = form.querySelector(Selectors.fields.markscheme);\n       // const maxmarks = form.querySelector(Selectors.fields.maxmarks);\n        const region = form.querySelector(Selectors.fields.region);\n        const targetlanguage = form.querySelector(Selectors.fields.targetlanguage);\n        const feedbacklanguage = form.querySelector(Selectors.fields.feedbacklanguage);\n\n        //if(sampleanswer.value===\"\" || feedbackscheme.value===\"\" || markscheme.value===\"\"){\n        if(sampleanswer.value===\"\"){\n            Notify.alert(strings.prompttester, strings.sampleanswerempty);\n            return;\n        }\n\n        //put  spinner in place\n        sampleanswereval.innerHTML='<i class=\"icon fa fa-spinner fa-spin fa-2x\" style=\"margin: auto; padding: 10px;\"></i>';\n        Log.debug(\"calling ajax\");\n        Ajax.call([{\n            methodname: 'mod_solo_fetch_ai_grade',\n            args: {\n                region: region.value,\n                targetlanguage: targetlanguage.value,\n                questiontext: '',//questiontext.value,\n                studentresponse: sampleanswer.value,\n                markscheme: markscheme.value,\n                maxmarks: 100,\n                feedbackscheme: feedbackscheme.value,\n                feedbacklanguage: feedbacklanguage.value,\n            },\n            async: false\n        }])[0].then(function(airesponse) {\n            Log.debug(airesponse);\n            if (airesponse.correctedtext) {\n                Templates.render('mod_solo/aigradepreview',airesponse).then(\n                    function(html,js){\n                        sampleanswereval.innerHTML=html;\n                    }\n                );\n            }\n        });\n    });//end of click\n};\n"],"names":["Selectors","fields","sampleanswer","sampleanswereval","feedbackscheme","markscheme","maxmarks","props","previewbtn","document","querySelector","previewbtnid","sampleanswerid","sampleanswerevalid","feedbackschemeid","markschemeid","region","regionid","targetlanguage","targetlanguageid","feedbacklanguage","feedbacklanguageid","strings","done","s","i","prompttester","sampleanswerempty","debug","addEventListener","e","form","target","closest","questiontext","value","innerHTML","call","methodname","args","studentresponse","async","then","airesponse","correctedtext","render","html","js","alert"],"mappings":";;;;;;;8PA4BIA,UAAY,CACZC,OAAQ,CACJC,aAAc,IACdC,iBAAkB,IAClBC,eAAgB,IAChBC,WAAY,IACZC,SAAU,oBAOGC,YAGbC,WAAaC,SAASC,cAAcH,MAAMI,cAG9CX,UAAUC,OAAOC,aAAeK,MAAMK,eACtCZ,UAAUC,OAAOE,iBAAmBI,MAAMM,mBAC1Cb,UAAUC,OAAOG,eAAiBG,MAAMO,iBACxCd,UAAUC,OAAOI,WAAaE,MAAMQ,aAEpCf,UAAUC,OAAOe,OAAST,MAAMU,SAChCjB,UAAUC,OAAOiB,eAAiBX,MAAMY,iBACxCnB,UAAUC,OAAOmB,iBAAmBb,MAAMc,uBAItCC,QAAQ,wBACA,CACR,KAAS,yBAA6B,YACtC,KAAS,8BAAkC,cAE5CC,MAAK,SAAUC,OACVC,EAAI,EACRH,QAAQI,aAAeF,EAAEC,KACzBH,QAAQK,kBAAoBH,EAAEC,qBAE9BG,MAAM,4CAEVpB,WAAWqB,iBAAiB,SAASC,UAE3BC,KAAOD,EAAEE,OAAOC,QAAQ,QAExB/B,cADe6B,KAAKrB,cAAcV,UAAUC,OAAOiC,cACpCH,KAAKrB,cAAcV,UAAUC,OAAOC,eACnDC,iBAAmB4B,KAAKrB,cAAcV,UAAUC,OAAOE,kBACvDC,eAAiB2B,KAAKrB,cAAcV,UAAUC,OAAOG,gBACrDC,WAAa0B,KAAKrB,cAAcV,UAAUC,OAAOI,YAEjDW,OAASe,KAAKrB,cAAcV,UAAUC,OAAOe,QAC7CE,eAAiBa,KAAKrB,cAAcV,UAAUC,OAAOiB,gBACrDE,iBAAmBW,KAAKrB,cAAcV,UAAUC,OAAOmB,kBAGrC,KAArBlB,aAAaiC,OAMhBhC,iBAAiBiC,UAAU,qGACvBR,MAAM,8BACLS,KAAK,CAAC,CACPC,WAAY,0BACZC,KAAM,CACFvB,OAAQA,OAAOmB,MACfjB,eAAgBA,eAAeiB,MAC/BD,aAAc,GACdM,gBAAiBtC,aAAaiC,MAC9B9B,WAAYA,WAAW8B,MACvB7B,SAAU,IACVF,eAAgBA,eAAe+B,MAC/Bf,iBAAkBA,iBAAiBe,OAEvCM,OAAO,KACP,GAAGC,MAAK,SAASC,yBACbf,MAAMe,YACNA,WAAWC,kCACDC,OAAO,0BAA0BF,YAAYD,MACnD,SAASI,KAAKC,IACV5C,iBAAiBiC,UAAUU,kCAzBhCE,MAAM1B,QAAQI,aAAcJ,QAAQK"}