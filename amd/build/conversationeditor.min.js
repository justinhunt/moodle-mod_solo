define ("mod_solo/conversationeditor",["jquery","mod_solo/definitions","mod_solo/conversationconstants","mod_solo/vtthelper","mod_solo/conversationset","mod_solo/playerhelper","core/templates"],function(a,b,c,d,e,f,g){return{controls:{},currentindex:!1,currentitemcontainer:null,editoropen:!1,firstrender:!0,init:function init(a,b){e.init(a);f.init(b);this.initControls();this.initTiles();this.initEvents()},initControls:function initControls(){this.controls.container=a("#poodllconvedit_tiles");this.controls.editor=a("#poodllconvedit_editor");this.controls.number=a("#poodllconvedit_editor .numb_song");this.controls.edpart=a("#"+b.C_EDITFIELD);this.controls.buttondelete=a("#"+b.C_BUTTONDELETE);this.controls.buttonmoveup=a("#"+b.C_BUTTONMOVEUP);this.controls.buttonmovedown=a("#"+b.C_BUTTONMOVEDOWN);this.controls.buttonapply=a("#"+b.C_BUTTONAPPLY);this.controls.buttoncancel=a("#"+b.C_BUTTONCANCEL);this.controls.buttonaddnew=a("#poodllconvedit_addnew")},hideEditor:function hideEditor(){this.controls.editor.detach();this.controls.editor.hide();this.editoropen=!1},restoreTile:function restoreTile(){var a=e.fetchItem(this.currentindex),b=this;this.fetchNewTextTile(this.currentindex,a.part,function onend(a){b.hideEditor();b.currentitemcontainer.append(a)})},editorToTile:function editorToTile(b,c,d,f){var g=a(b.edpart).val();e.updateItem(c,g);this.doSave();var h=this;this.fetchNewTextTile(c,g,function on_fetch_finish(b){if(!h.editoropen){return}h.hideEditor();d.append(b);a(d).removeClass("warning");if(f){f()}});return!0},initEvents:function initEvents(){var c=this;this.controls.container.on("click",".poodllconvedit_tt",function(){var b=parseInt(a(this).parent().attr("data-id")),d=a(this).parent(),e=function(){c.currentindex=b;c.currentitemcontainer=d;c.shiftEditor(c.currentindex,c.currentitemcontainer)};if(!0===c.editoropen){c.editorToTile(c.controls,c.currentindex,c.currentitemcontainer,e)}else{e()}});this.controls.container.on("click","#"+b.C_BUTTONDELETE,function(){result=confirm("Warning! This tile is going to be deleted!");if(result){c.restoreTile();e.removeItem(c.currentindex);c.syncFrom(c.currentindex)}else{}});this.controls.container.on("click","#"+b.C_BUTTONMOVEUP,function(){c.editorToTile(c.controls,c.currentindex,c.currentitemcontainer,function onend(){e.moveup(c.currentindex);c.syncFrom(c.currentindex-1);c.doSave()})});this.controls.container.on("click","#"+b.C_BUTTONMOVEDOWN,function(){c.editorToTile(c.controls,c.currentindex,c.currentitemcontainer,function onend(){e.movedown(c.currentindex);c.syncFrom(c.currentindex);c.doSave()})});this.controls.container.on("click","#"+b.C_BUTTONAPPLY,function(){c.editorToTile(c.controls,c.currentindex,c.currentitemcontainer)});this.controls.container.on("focusout",function(){c.editorToTile(c.controls,c.currentindex,c.currentitemcontainer)});this.controls.container.on("click","#"+b.C_BUTTONCANCEL,function(){c.restoreTile()});this.controls.buttonaddnew.click(function(){var b=e.fetchCount(),d=b;if(0<b){e.fetchItem(b-1)}e.addItem(d,"");c.fetchNewTextTileContainer(d,"",function onend(b){c.controls.container.append(b);a(".poodllconvedit_itemcontainer[data-id=\""+d+"\"] .poodllconvedit_tt").trigger("click")})})},initTiles:function initTiles(){var a=this.controls.container,b=this,c=e.fetchCount();this.fetchNewTextTile(0,"",function reallyInitTiles(){if(0<c){for(var d=0;d<c;d++){var f=e.fetchItem(d),g=function(b){a.append(b)},h=b.fetchNewTextTileContainer(d,f.part,g)}}})},shiftEditor:function shiftEditor(b,c){this.controls.editor.hide();var d=e.fetchItem(b),f=d.part;a(this.controls.edpart).val(f);c.empty();c.append(this.controls.editor);this.controls.editor.show();this.editoropen=!0;a(this.controls.number).text(b+1)},fetchNewTextTile:function fetchNewTextTile(a,b,c){var d=[];d.imgpath=M.cfg.wwwroot+"/mod/solo/pix/e/";d.dataid=a+1;d.part=b;g.render("mod_solo/convtile",d).then(function(a){c(a)})},fetchNewTextTileContainer:function fetchNewTextTileContainer(a,b,c){var d=[];d.imgpath=M.cfg.wwwroot+"/mod/solo/pix/e/";d.outerdataid=a;d.dataid=a+1;d.part=b;g.render("mod_solo/convtilecontainer",d).then(function(a){c(a)})},clearTiles:function clearTiles(){this.controls.container.empty()},resetData:function resetData(a){this.hideEditor();this.clearTiles();e.init(a);this.initTiles();this.doSave()},syncFrom:function syncFrom(b){for(var c=e.fetchCount(),d=this,f=b;f<c;f++){var g=e.fetchItem(f),h=a(".poodllconvedit_itemcontainer").filter(function(){return parseInt(a(this).attr("data-id"))==f});if(0<h.length){this.updateTextTile(h,g)}else{var i=function(a){d.controls.container.append(a)},j=this.fetchNewTextTileContainer(f,g.part,i)}}a(".poodllconvedit_itemcontainer").filter(function(){return parseInt(a(this).attr("data-id"))>=c}).remove()},syncAt:function syncAt(){},updateTextTile:function updateTextTile(b,c){a(b).find(".poodllconvedit_tt_part").text(c.part)},fetchTranscriptionData:function fetchTranscriptionData(){return e.fetchTranscriptionData()},doSave:function doSave(){}}});
//# sourceMappingURL=conversationeditor.min.js.map
