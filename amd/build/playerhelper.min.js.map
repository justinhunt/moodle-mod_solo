{"version":3,"sources":["../src/playerhelper.js"],"names":["define","$","constants","controls","init","mediatype","initControls","registerEvents","mediatype_video","mediaPlayer","videoplayer","audioplayer","playBtn","playbutton","prevBtn","prevbutton","nextBtn","nextbutton","progressBar","progressbar","progressLine","progressline","greenProgress","greenprogress","progressMarker","progressmarker","mediaDuration","timeTotal","timetotal","timeCurrent","timecurrent","toTimeString","date","split","slice","moveSlider","stepBack","current","currentTime","stepForward","duration","getCoords","elem","box","getBoundingClientRect","top","pageYOffset","left","pageXOffset","c","that","click","e","preventDefault","readyState","hasClass","pause","play","toggleClass","alert","$target","target","progressVal","offsetX","barWidth","width","positionRatio","progressCurrent","css","opacity","durationCurrent","Date","text","on","isNaN","isFinite","video","durationRatio","leftPosition","sliderElem","thumbElem","onmousedown","sliderCoords","document","onmousemove","newLeft","pageX","rightEdge","offsetWidth","style","onmouseup","ondragstart"],"mappings":"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","sourcesContent":["define([\"jquery\", \"mod_solo/conversationconstants\"], function($, constants) {\r\n\r\n    return {\r\n        controls: {},\r\n\r\n        init: function(mediatype){\r\n           this.initControls(mediatype);\r\n           this.registerEvents();\r\n        },\r\n\r\n        initControls: function(mediatype){\r\n            if(mediatype === constants.mediatype_video) {\r\n                this.controls.mediaPlayer = $(constants.videoplayer);\r\n            }else{\r\n                this.controls.mediaPlayer = $(constants.audioplayer);\r\n            }\r\n            this.controls.playBtn = $(constants.playbutton);\r\n            this.controls.prevBtn = $(constants.prevbutton);\r\n            this.controls.nextBtn = $(constants.nextbutton);\r\n            this.controls.progressBar = $(constants.progressbar);\r\n            this.controls.progressLine = $(constants.progressline);\r\n            this.controls.greenProgress = $(constants.greenprogress);\r\n            this.controls.progressMarker = $(constants.progressmarker);\r\n            this.controls.mediaDuration = 0;\r\n            this.controls.timeTotal = $(constants.timetotal);\r\n            this.controls.timeCurrent = $(constants.timecurrent);\r\n        },\r\n\r\n        toTimeString: function (date) {\r\n            var date = date.toTimeString().split(' ')[0];\r\n            date = date.slice(3, 8);\r\n            return date;\r\n        },\r\n\r\n        moveSlider: function(event) {\r\n\r\n        },\r\n\r\n        stepBack: function() {\r\n            var current = this.controls.mediaPlayer[0].currentTime;\r\n            if (current > 5) {\r\n                current -= 5;\r\n            } else {\r\n                current = 0;\r\n            }\r\n            this.controls.mediaPlayer[0].currentTime = current;\r\n        },\r\n        stepForward: function() {\r\n            var current = this.controls.mediaPlayer[0].currentTime;\r\n            var duration = this.controls.mediaPlayer[0].duration;\r\n            if (current <= (duration - 5)) {\r\n                current += 5;\r\n            } else {\r\n                current = duration;\r\n            }\r\n            this.controls.mediaPlayer[0].currentTime = current;\r\n        },\r\n\r\n        getCoords: function(elem) {\r\n            var box = elem.getBoundingClientRect();\r\n\r\n            return {\r\n                top: box.top + pageYOffset,\r\n                left: box.left + pageXOffset\r\n            };\r\n\r\n        },\r\n\r\n        registerEvents: function(){\r\n\r\n            var c = this.controls;\r\n            var that = this;\r\n\r\n            c.playBtn.click(function(e) {\r\n                e.preventDefault();\r\n                var readyState = c.mediaPlayer[0].readyState;\r\n\r\n                if (readyState == '4') {\r\n                    if (c.playBtn.hasClass('playing')) {\r\n                        c.mediaPlayer[0].pause();\r\n                    } else {\r\n                        c.mediaPlayer[0].play();\r\n                    }\r\n\r\n                    c.playBtn.toggleClass('playing');\r\n                } else {\r\n                    alert('No media..');\r\n                }\r\n\r\n\r\n\r\n            });\r\n\r\n            c.prevBtn.click(function(e) {\r\n                e.preventDefault();\r\n                that.stepBack();\r\n            });\r\n\r\n            c.nextBtn.click(function(e) {\r\n                e.preventDefault();\r\n                that.stepForward();\r\n            });\r\n\r\n            c.progressLine.click(function(e) {\r\n                e.preventDefault();\r\n\r\n                var $target = $(e.target);\r\n\r\n                if ($target.hasClass('progress-marker')) {\r\n                    return false;\r\n                }\r\n\r\n                var progressVal = e.offsetX;\r\n                var barWidth = c.progressLine.width();\r\n                var positionRatio = progressVal / barWidth;\r\n                var progressCurrent = positionRatio * 100;\r\n\r\n                c.greenProgress.width(progressCurrent + '%');\r\n                c.progressMarker.css(\r\n                    {\r\n                        left: progressCurrent + '%',\r\n                        opacity: 1\r\n                    }\r\n                );\r\n\r\n                c.mediaPlayer[0].currentTime = c.mediaDuration * positionRatio;\r\n\r\n                var durationCurrent = new Date(0, 0, 0, 0, 0, 0, c.mediaDuration * positionRatio * 1000);\r\n                c.timeCurrent.text(that.toTimeString(durationCurrent));\r\n\r\n            });\r\n\r\n            c.mediaPlayer.on('loadeddata', function(e) {\r\n                c.mediaDuration = c.mediaPlayer[0].duration;\r\n                if(!isNaN(c.mediaDuration) && isFinite(c.mediaDuration)){\r\n                    var duration = new Date(0, 0, 0, 0, 0, 0, c.mediaDuration * 1000);\r\n                    c.timeTotal.text(that.toTimeString(duration));\r\n                }\r\n\r\n                c.timeCurrent.text('0:00');\r\n\r\n                //init progress marker\r\n                c.progressMarker.css(\r\n                    {\r\n                        left: '0%',\r\n                        opacity: 1\r\n                    }\r\n                );\r\n\r\n                //add the timeupdate event. If you add this before now, it fails cos no media was loaded\r\n                c.mediaPlayer.on('timeupdate', function (ex) {\r\n                    // Update progress bar\r\n                    var video = c.mediaPlayer[0];\r\n                    var durationRatio = video.currentTime / video.duration;\r\n                    var leftPosition = durationRatio * 100 + '%';\r\n\r\n                    c.greenProgress.width(leftPosition);\r\n                    c.progressMarker.css(\r\n                        {\r\n                            left: leftPosition,\r\n                            opacity: 1\r\n\r\n                        }\r\n                    );\r\n\r\n                    // Update playback duration\r\n                    var currentTime = new Date(0, 0, 0, 0, 0, 0, video.currentTime * 1000);\r\n                    currentTime = that.toTimeString(currentTime);\r\n                    c.timeCurrent.text(currentTime);\r\n\r\n                });\r\n            });\r\n\r\n            c.mediaPlayer.on('durationchange', function(e) {\r\n                c.mediaDuration = c.mediaPlayer[0].duration;\r\n                if(!isNaN(c.mediaDuration) && isFinite(c.mediaDuration)){\r\n                    var duration = new Date(0, 0, 0, 0, 0, 0, c.mediaDuration * 1000);\r\n                    c.timeTotal.text(that.toTimeString(duration));\r\n                }\r\n            });\r\n\r\n\r\n\r\n            var sliderElem = c.progressLine[0];\r\n            var thumbElem = c.progressMarker[0];\r\n\r\n            thumbElem.onmousedown = function(e) {\r\n\r\n                var sliderCoords = that.getCoords(sliderElem);\r\n\r\n                document.onmousemove = function(e) {\r\n                    var newLeft = e.pageX - sliderCoords.left;\r\n\r\n                    if (newLeft < 0) {\r\n                        newLeft = 0;\r\n                    }\r\n                    var rightEdge = sliderElem.offsetWidth;\r\n\r\n                    if (newLeft > rightEdge) {\r\n                        newLeft = rightEdge;\r\n                    }\r\n\r\n                    thumbElem.style.left = newLeft + 'px';\r\n                    c.greenProgress.width(newLeft + 'px');\r\n\r\n                    c.mediaPlayer[0].currentTime = c.mediaDuration * (newLeft / rightEdge);\r\n\r\n                    var durationCurrent = new Date(0, 0, 0, 0, 0, 0, c.mediaDuration * (newLeft / rightEdge) * 1000);\r\n                    c.timeCurrent.text(that.toTimeString(durationCurrent));\r\n\r\n                }\r\n\r\n                document.onmouseup = function(e) {\r\n                    document.onmousemove = document.onmouseup = null;\r\n                };\r\n\r\n            };\r\n\r\n            thumbElem.ondragstart = function() {\r\n                return false;\r\n            };\r\n\r\n        }//end of register events\r\n}//end of returned object\r\n\r\n});\r\n"],"file":"playerhelper.min.js"}