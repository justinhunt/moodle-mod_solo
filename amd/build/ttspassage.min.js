define(["jquery","core/log","core/str","core/templates","mod_solo/pollyhelper"],(function($,log,str,templates,polly){return log.debug("Solo TTS Passage: initialising"),{controls:{},checking:"... checking ...",init:function(uniqid){this.uniqid=uniqid,this.ready=!1,this.thesentence_number=0,this.lettered=!1,this.stoporpause="pause",this.sentenceselector="#"+this.uniqid+"_textblock span.tbr_sentence",this.init_strings(),this.register_controls(),this.register_events(),this.init_polly()},init_strings:function(){var that=this;str.get_string("checking","mod_solo").done((function(s){that.checking=s}))},init_polly:function(){var token=this.controls.ttspassagecont.attr("data-token"),region=this.controls.ttspassagecont.attr("data-region");polly.init(token,region,"poodll")},register_controls:function(){this.controls.ttspassagecont=$("#"+this.uniqid+"_ttspassageplayer"),this.controls.showttspassagebtn=$("#"+this.uniqid+"_showttspassagebtn"),this.controls.selftranscript=$("textarea[name='selftranscript']"),this.controls.ttssentencecont=$("#"+this.uniqid+"_ttssentencecont .tbr_innerdiv"),this.controls.aplayer=$("#"+this.uniqid+"_ttspassageaudio"),this.controls.theaplayerbtn=$("#"+this.uniqid+"_ttspassagebutton"),this.controls.textblock=$("#"+this.uniqid+"_textblock"),this.controls.fa=$("#"+this.uniqid+"_ttspassagebutton .fa"),this.controls.passagelines=$(this.sentenceselector)},register_events:function(){var that=this;that.controls.showttspassagebtn.click((function(e){return that.markup_and_show(),!1})),that.controls.aplayer[0].addEventListener("ended",(function(){that.thesentence_number<that.controls.passagelines.length-1?(that.thesentence_number++,that.doplayaudio(that.thesentence_number)):(that.dehighlight_all(),that.controls.fa.removeClass("fa-stop"),that.controls.fa.addClass("fa-volume-up"),that.thesentence_number=0,that.controls.aplayer.removeAttr("src"))})),that.controls.theaplayerbtn.click((function(){that.controls.aplayer[0].paused||that.controls.aplayer[0].ended?that.controls.aplayer[0].paused&&that.controls.aplayer.attr("src")?(that.controls.aplayer[0].play(),that.controls.fa.removeClass("fa-volume-up"),that.controls.fa.addClass("fa-stop")):(that.lettered||(that.lettered=!0),"stop"==that.stoporpause&&(that.thesentence_number=0),that.doplayaudio(that.thesentence_number),that.controls.fa.removeClass("fa-volume-up"),that.controls.fa.addClass("fa-stop")):(that.controls.aplayer[0].pause(),"stop"==that.stoporpause&&(that.controls.aplayer[0].load(),that.thesentence_number=0),that.controls.fa.removeClass("fa-stop"),that.controls.fa.addClass("fa-volume-up"))})),$("#"+that.uniqid+"_textblock  .tbr_innerdiv").on("click",".tbr_sentence",(function(){that.controls.aplayer[0].pause();var sentenceindex=$(this).attr("data-sentenceindex");that.controls.fa.removeClass("fa-volume-up"),that.controls.fa.addClass("fa-stop"),that.thesentence_number=sentenceindex,that.doplayaudio(sentenceindex)}))},dehighlight_all:function(){this.controls.passagelines.removeClass("passageplayer_activesentence")},highlight_sentence:function(thesentence){this.controls.passagelines.removeClass("passageplayer_activesentence"),$(this.controls.passagelines[thesentence]).addClass("passageplayer_activesentence")},doplayaudio:function(thesentence){log.debug(thesentence),this.highlight_sentence(thesentence),this.controls.aplayer.attr("src",$(this.controls.passagelines[thesentence]).data("audiourl")),this.controls.aplayer[0].play()},markup_and_show:function(){var that=this,text=that.controls.selftranscript.val();if(text&&""!==text&&""!==text.trim()){that.controls.ttssentencecont.empty();for(var sentences=text.split(/[\.\!\?¿¡\.\.\.;]/),i=0;i<sentences.length;i++){var audiourl=polly.fetch_polly_url(sentences[i],1,"Amy");templates.render("mod_solo/ttssentence",{sentence:sentences[i],audiourl:audiourl,sentenceindex:i}).then((function(html,js){templates.appendNodeContents(that.controls.ttssentencecont,html,js)}))}}}}}));

//# sourceMappingURL=ttspassage.min.js.map