{"version":3,"sources":["../src/conversationeditor.js"],"names":["define","$","def","constants","vtthelper","transcriptionset","playerhelper","templates","controls","currentindex","currentitemcontainer","editoropen","firstrender","init","transcriptiondata","mediatype","initControls","initTiles","initEvents","container","editor","number","edpart","C_EDITFIELD","buttondelete","C_BUTTONDELETE","buttonmoveup","C_BUTTONMOVEUP","buttonmovedown","C_BUTTONMOVEDOWN","buttonapply","C_BUTTONAPPLY","buttoncancel","C_BUTTONCANCEL","buttonaddnew","hideEditor","detach","hide","restoreTile","item","fetchItem","that","fetchNewTextTile","part","onend","tile","append","editorToTile","val","updateItem","doSave","on_fetch_finish","removeClass","on","newindex","parseInt","parent","attr","theparent","do_next_tile_edit","shiftEditor","result","confirm","removeItem","syncFrom","moveup","movedown","click","currentcount","fetchCount","newdataid","addItem","fetchNewTextTileContainer","newtile","trigger","setcount","reallyInitTiles","setindex","newitemcontainer","newitem","empty","show","text","dataid","tdata","M","cfg","wwwroot","render","then","html","clearTiles","resetData","index","filter","length","updateTextTile","remove","syncAt","find","fetchTranscriptionData"],"mappings":"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","sourcesContent":["define([\"jquery\", \"mod_solo/definitions\", \"mod_solo/conversationconstants\", \"mod_solo/vtthelper\",\"mod_solo/conversationset\",\"mod_solo/playerhelper\",\"core/templates\"],\r\n    function($, def, constants, vtthelper, transcriptionset, playerhelper,templates) {\r\n\r\n    //pooodlltranscription helper is about the transcription tiles and editing\r\n\r\n  return {\r\n      controls: {},\r\n      currentindex: false,\r\n      currentitemcontainer: null,\r\n      editoropen: false,\r\n      firstrender: true,\r\n\r\n      //set up the transcription edit session\r\n      init: function(transcriptiondata,mediatype){\r\n          transcriptionset.init(transcriptiondata);\r\n          playerhelper.init(mediatype);\r\n          this.initControls();\r\n          this.initTiles();\r\n          this.initEvents();\r\n      },\r\n\r\n      //set up our internal references to the elements on the page\r\n      initControls: function(){\r\n          this.controls.container = $(\"#poodllconvedit_tiles\");\r\n          this.controls.editor = $(\"#poodllconvedit_editor\");\r\n          this.controls.number = $(\"#poodllconvedit_editor .numb_song\");\r\n          this.controls.edpart = $(\"#\" + def.C_EDITFIELD);\r\n          this.controls.buttondelete = $(\"#\" + def.C_BUTTONDELETE);\r\n          this.controls.buttonmoveup = $(\"#\" + def.C_BUTTONMOVEUP);\r\n          this.controls.buttonmovedown = $(\"#\" + def.C_BUTTONMOVEDOWN);\r\n          this.controls.buttonapply = $(\"#\" + def.C_BUTTONAPPLY);\r\n          this.controls.buttoncancel = $(\"#\" + def.C_BUTTONCANCEL);\r\n          this.controls.buttonaddnew = $(\"#poodllconvedit_addnew\");\r\n;\r\n      },\r\n\r\n      hideEditor: function(){\r\n          this.controls.editor.detach();\r\n          this.controls.editor.hide();\r\n          this.editoropen=false;\r\n      },\r\n\r\n      restoreTile: function(){\r\n         var item = transcriptionset.fetchItem(this.currentindex);\r\n         var that=this;\r\n\r\n          var onend = function(tile){\r\n              that.hideEditor();\r\n              that.currentitemcontainer.append(tile);\r\n          };\r\n         this.fetchNewTextTile(this.currentindex,item.part, onend);\r\n\r\n      },\r\n\r\n      editorToTile: function(controls,currentindex,currentitemcontainer, onend){\r\n          var part = $(controls.edpart).val();\r\n          transcriptionset.updateItem(currentindex,part);\r\n          this.doSave();\r\n\r\n          var that = this;\r\n          var on_fetch_finish = function(tile){\r\n              //occasionally two event handlers will fire this and we get two tiles in one\r\n              //this is an ugly check to prevent that\r\n              if(!that.editoropen){return;}\r\n\r\n              that.hideEditor();\r\n              currentitemcontainer.append(tile);\r\n              $(currentitemcontainer).removeClass('warning');\r\n              if(onend){\r\n                  onend();\r\n              }\r\n          };\r\n          this.fetchNewTextTile(currentindex,part, on_fetch_finish);\r\n          return true;\r\n\r\n      },\r\n\r\n      //attach events to the elements on the page\r\n      initEvents: function(){\r\n          var that = this;\r\n          //this attaches event to classes of poodllconvedit_tt in \"container\"\r\n          //so new items(created at runtime) get events by default\r\n          this.controls.container.on(\"click\",'.poodllconvedit_tt',function(){\r\n              var newindex = parseInt($(this).parent().attr('data-id'));\r\n              var theparent = $(this).parent();\r\n              var do_next_tile_edit = function(){\r\n                  that.currentindex = newindex;\r\n                  that.currentitemcontainer = theparent;\r\n                  that.shiftEditor(that.currentindex ,that.currentitemcontainer);\r\n              }\r\n              //save current\r\n              if(that.editoropen === true){\r\n\r\n                  that.editorToTile(that.controls,that.currentindex,that.currentitemcontainer, do_next_tile_edit);\r\n              }else{\r\n                  do_next_tile_edit();\r\n              }\r\n\r\n\r\n           });\r\n\r\n          //editor button delete tile click event\r\n          this.controls.container.on(\"click\",'#' + def.C_BUTTONDELETE,function(){\r\n          //this.controls.buttondelete.click(function(){\r\n              result = confirm('Warning! This tile is going to be deleted!');\r\n              if (result) {\r\n                that.restoreTile();\r\n                transcriptionset.removeItem(that.currentindex);\r\n                that.syncFrom(that.currentindex);\r\n\r\n              } else {\r\n                  return;\r\n              }\r\n\r\n          });\r\n\r\n          //editor button merge with prev tile click event\r\n          this.controls.container.on(\"click\",'#' + def.C_BUTTONMOVEUP,function(){\r\n              var onend = function(){\r\n                  transcriptionset.moveup(that.currentindex);\r\n                  that.syncFrom(that.currentindex-1);\r\n                  that.doSave();\r\n              }\r\n              that.editorToTile(that.controls,that.currentindex,that.currentitemcontainer, onend);\r\n\r\n\r\n          });\r\n\r\n          //editor button split current tile click event\r\n          this.controls.container.on(\"click\",'#' + def.C_BUTTONMOVEDOWN,function(){\r\n              var onend = function(){\r\n                  transcriptionset.movedown(that.currentindex);\r\n                  that.syncFrom(that.currentindex);\r\n                  that.doSave();\r\n              }\r\n              that.editorToTile(that.controls,that.currentindex,that.currentitemcontainer, onend);\r\n\r\n          });\r\n\r\n\r\n          //editor button apply changesclick event\r\n          this.controls.container.on(\"click\",'#' + def.C_BUTTONAPPLY,function(){\r\n              that.editorToTile(that.controls,that.currentindex,that.currentitemcontainer);\r\n          });\r\n\r\n          //if the user clicks out of the editor (probably by clicking the form \"next button)\r\n          //editor button apply changesclick event\r\n          this.controls.container.on(\"focusout\",function(){\r\n              that.editorToTile(that.controls,that.currentindex,that.currentitemcontainer);\r\n          });\r\n\r\n\r\n          //editor button cancel changes click event\r\n          this.controls.container.on(\"click\",'#' + def.C_BUTTONCANCEL,function(){\r\n              that.restoreTile();\r\n          });\r\n\r\n\r\n          //\"Add new tile\" button click event\r\n          this.controls.buttonaddnew.click(function(){\r\n              var currentcount = transcriptionset.fetchCount();\r\n              var newdataid=currentcount;\r\n              if(currentcount >0){\r\n                  var lastitem = transcriptionset.fetchItem(currentcount-1);\r\n              }\r\n\r\n              transcriptionset.addItem(newdataid,'');\r\n\r\n              var onend = function(newtile){\r\n                  //append new tile\r\n                  that.controls.container.append(newtile);\r\n                  //its likely you want to edit it too, so we click it\r\n                  $('.poodllconvedit_itemcontainer[data-id=\"' + newdataid + '\"] .poodllconvedit_tt').trigger('click');\r\n              };\r\n              var newtile = that.fetchNewTextTileContainer(newdataid,'',onend);\r\n\r\n          });\r\n\r\n\r\n      },\r\n\r\n\r\n      //each transcription item has a \"text tile\" with transcript text that we display\r\n      //when clicked we swap it out for the editor\r\n      //this takes all the transcription json and creates one tiles on page for each transcript part\r\n      initTiles: function(){\r\n          var container = this.controls.container;\r\n          var that = this;\r\n          var setcount = transcriptionset.fetchCount();\r\n\r\n          //the first render of template takes time and puts the first tile rendered after subsequent tiles,\r\n          // a better way might be force the order but for now we force an empty first render, and set reallyInitTiles to run after that\r\n          var reallyInitTiles = function() {\r\n              if (setcount > 0) {\r\n                  for (var setindex = 0; setindex < setcount; setindex++) {\r\n                      var item = transcriptionset.fetchItem(setindex);\r\n                      var onend = function (newtile) {\r\n                          container.append(newtile);\r\n                      };\r\n                      var newtile = that.fetchNewTextTileContainer(setindex, item.part, onend);\r\n                  }\r\n                  ;//end of for loop\r\n              }//end of if setcount\r\n          };\r\n          this.fetchNewTextTile(0,'',reallyInitTiles);\r\n      },\r\n\r\n\r\n      //Replace text tile we are editing with the editor, fill with data and display it\r\n      shiftEditor: function(newindex,newitemcontainer){\r\n\r\n          //hide editor\r\n          this.controls.editor.hide();\r\n\r\n          //newitem\r\n          var newitem =transcriptionset.fetchItem(newindex);\r\n\r\n          var part = newitem.part;\r\n          $(this.controls.edpart).val(part);\r\n\r\n          //remove old text tile and show editor in its place\r\n          newitemcontainer.empty();\r\n          newitemcontainer.append(this.controls.editor);\r\n          this.controls.editor.show();\r\n          this.editoropen=true;\r\n\r\n          $(this.controls.number).text(newindex + 1);\r\n\r\n      },\r\n\r\n      //Merge a template text tile,  with the time and transcription text data\r\n      fetchNewTextTile: function(dataid, part, onend){\r\n          var tdata=[];\r\n          tdata['imgpath'] = M.cfg.wwwroot + '/mod/solo/pix/e/';\r\n          tdata['dataid'] = dataid+1;\r\n          tdata['part'] = part;\r\n\r\n          templates.render('mod_solo/convtile',tdata).then(\r\n              function(html,js){\r\n                    onend(html);\r\n              }\r\n          );\r\n      },\r\n\r\n      //Merge a template text tile,  with the time and transcription text data\r\n      fetchNewTextTileContainer: function(dataid, part, onend){\r\n          var tdata=[];\r\n          tdata['imgpath'] = M.cfg.wwwroot + '/mod/solo/pix/e/';\r\n          tdata['outerdataid'] = dataid;\r\n          tdata['dataid'] = dataid+1;\r\n          tdata['part'] = part;\r\n\r\n          templates.render('mod_solo/convtilecontainer',tdata).then(\r\n              function(html,js){\r\n                    onend(html);\r\n              }\r\n          );\r\n      },\r\n\r\n      clearTiles: function(){\r\n          this.controls.container.empty();\r\n      },\r\n\r\n      resetData: function(transcriptiondata){\r\n          this.hideEditor();\r\n          this.clearTiles();\r\n          transcriptionset.init(transcriptiondata);\r\n          this.initTiles();\r\n          this.doSave();\r\n      },\r\n\r\n      syncFrom: function(index){\r\n          var setcount = transcriptionset.fetchCount();\r\n          var that=this;\r\n          for(var setindex=index; setindex < setcount;setindex++){\r\n              var item =transcriptionset.fetchItem(setindex);\r\n              var container = $('.poodllconvedit_itemcontainer').filter(function() {\r\n                  return parseInt($(this).attr(\"data-id\")) == setindex;\r\n              });\r\n              if(container.length > 0){\r\n                  this.updateTextTile(container,item);\r\n              }else{\r\n                  var onend = function(newtile){that.controls.container.append(newtile);};\r\n                  var newtile = this.fetchNewTextTileContainer(setindex,item.part,onend);\r\n              }\r\n          }\r\n          //remove any elements greater than the last data-id\r\n          $('.poodllconvedit_itemcontainer').filter(function() {\r\n              return parseInt($(this).attr(\"data-id\")) >= setcount;\r\n          }).remove();\r\n      },\r\n      syncAt: function(index){\r\n          //do something\r\n\r\n      },\r\n      updateTextTile: function(container,item){\r\n          $(container).find('.poodllconvedit_tt_part').text(item.part);\r\n          return;\r\n      },\r\n\r\n\r\n      fetchTranscriptionData: function(){\r\n          return transcriptionset.fetchTranscriptionData();\r\n      },\r\n\r\n      //overwrite this in your calling class\r\n      doSave: function(){\r\n          //do something\r\n      }\r\n  }\r\n});\r\n"],"file":"conversationeditor.min.js"}